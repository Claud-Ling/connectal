== Zynq Portal Driver


Get the kernel source tree and build it:

----------------------------------------
    git clone git://github.com/cambridgehackers/device_xilinx_kernel
    git checkout origin/xbsv-2014.04  -b xbsv-2014.04
    cd device_xilinx_kernel
    make ARCH=arm xilinx_zynq_portal_defconfig 
----------------------------------------

If you use a Xilinx toolchain:

----------------------------------------
    make ARCH=arm CROSS_COMPILE=arm-xilinx-linux-gnueabi- -j20 zImage modules
----------------------------------------

If you use an Android NDK toolchain:

----------------------------------------
    make ARCH=arm CROSS_COMPILE=arm-linux-androideabi- -j20 zImage modules
----------------------------------------

If you use a Code Sourcery toolchain:

----------------------------------------
    make ARCH=arm CROSS_COMPILE=arm-none-linux-gnueabi- -j20 zImage modules
----------------------------------------

To Build the zynq portal driver, Makefile needs to be pointed to the root of the kernel source tree:

----------------------------------------
    export DEVICE_XILINX_KERNEL=/path/to/device_xilinx_kernel/
----------------------------------------

The driver sources are located in the xbsv project:

----------------------------------------
    cd xbsv
    (cd drivers/zynqportal/; DEVICE_XILINX_KERNEL=`pwd`/../../../device_xilinx_kernel/ make zynqportal.ko)
    (cd drivers/portalmem/;  DEVICE_XILINX_KERNEL=`pwd`/../../../device_xilinx_kernel/ make portalmem.ko)
    adb push drivers/zynqportal/zynqportal.ko /mnt/sdcard
    adb push drivers/portalmem/portalmem.ko /mnt/sdcard
----------------------------------------

To update the zynq portal driver running on the Zync platform, set ADB_PORT appropriately and run the following commands:

----------------------------------------
    ADB_PORT=5555
    adb -s $ADB_PORT push zynqportal.ko /mnt/sdcard/
    adb -s $ADB_PORT shell "cd /mnt/sdcard/ && uname -r | xargs rm -rf"
    adb -s $ADB_PORT shell "cd /mnt/sdcard/ && uname -r | xargs mkdir"
    adb -s $ADB_PORT shell "cd /mnt/sdcard/ && uname -r | xargs mv zynqportal.ko"
    adb -s $ADB_PORT shell "modprobe -r zynqportal"
    adb -s $ADB_PORT shell "modprobe zynqportal"
----------------------------------------
